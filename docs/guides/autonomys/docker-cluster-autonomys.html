<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-guides/autonomys/docker-cluster-autonomys" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Run an Autonomys Cluster Farmer on Docker | Hake Hardware</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://hakehardware.github.io/img/hakehardware.png"><meta data-rh="true" name="twitter:image" content="https://hakehardware.github.io/img/hakehardware.png"><meta data-rh="true" property="og:url" content="https://hakehardware.github.io/docs/guides/autonomys/docker-cluster-autonomys"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Run an Autonomys Cluster Farmer on Docker | Hake Hardware"><meta data-rh="true" name="description" content="This guide was created for Gemeni 3h testnet and will be updated to mainnet once released."><meta data-rh="true" property="og:description" content="This guide was created for Gemeni 3h testnet and will be updated to mainnet once released."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://hakehardware.github.io/docs/guides/autonomys/docker-cluster-autonomys"><link data-rh="true" rel="alternate" href="https://hakehardware.github.io/docs/guides/autonomys/docker-cluster-autonomys" hreflang="en"><link data-rh="true" rel="alternate" href="https://hakehardware.github.io/docs/guides/autonomys/docker-cluster-autonomys" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Hake Hardware RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Hake Hardware Atom Feed"><link rel="stylesheet" href="/assets/css/styles.4f54cfa0.css">
<script src="/assets/js/runtime~main.a2f820af.js" defer="defer"></script>
<script src="/assets/js/main.153a117a.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/hakehardware.svg" alt="Hake Hardware Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/hakehardware.svg" alt="Hake Hardware Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Hake Hardware</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/category/linux">Guides</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/hakehardware" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/linux">Linux</a><button aria-label="Expand sidebar category &#x27;Linux&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/comet">COMET (CM3588)</a><button aria-label="Expand sidebar category &#x27;COMET (CM3588)&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/autonomys">Autonomys</a><button aria-label="Collapse sidebar category &#x27;Autonomys&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/autonomys/docker-node-autonomys">Run an Autonomys Node on Docker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/guides/autonomys/docker-cluster-autonomys">Run an Autonomys Cluster Farmer on Docker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/autonomys/prep-your-drives-for-autonomys">Prep Your Drives for Autonomys</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/autonomys/advanced-clusters">Advanced Autonomys Clusters</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/autonomys"><span itemprop="name">Autonomys</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Run an Autonomys Cluster Farmer on Docker</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Run an Autonomys Cluster Farmer on Docker</h1></header><div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>This guide was created for Gemeni 3h testnet and will be updated to mainnet once released.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h2>
<p>Before setting up a Cluster Farmer, you should already:</p>
<ol>
<li>Have a Node running. <a href="https://hakehardware.github.io/docs/guides/autonomys/docker-node-autonomys" target="_blank" rel="noopener noreferrer">Run an Autonomys Node on Docker</a>.</li>
<li>Have prepped your drives. <a href="https://hakehardware.github.io/docs/guides/autonomys/prep-your-drives-for-autonomys" target="_blank" rel="noopener noreferrer">Prep Your Drives for Autonomys</a></li>
<li>Have Docker installed <a href="https://hakehardware.github.io/docs/guides/linux/install-docker-debian" target="_blank" rel="noopener noreferrer">Install Docker on Debian</a></li>
<li>Have Portainer Installed <a href="https://hakehardware.github.io/docs/guides/linux/install-portainer-host-agent" target="_blank" rel="noopener noreferrer">Install Portainer Host/Agent</a></li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="create-an-autonomys-network-in-docker">Create an Autonomys Network in Docker<a href="#create-an-autonomys-network-in-docker" class="hash-link" aria-label="Direct link to Create an Autonomys Network in Docker" title="Direct link to Create an Autonomys Network in Docker">​</a></h2>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>You only need to create the network once for each PC. If you already created it on this PC you can skip this step.</p></div></div>
<p>Create the &quot;autonomys-network&quot; we will use to deploy our Autonomys containers on:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo docker network create \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --driver bridge \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --subnet 172.25.0.0/16 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --gateway 172.25.0.1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  autonomys-network</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This creates a new network called &quot;autonomys-network&quot; using the subnet 172.25.0.0/16 and the gateway 172.25.0.1.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="cluster-farmer-architecture">Cluster Farmer Architecture<a href="#cluster-farmer-architecture" class="hash-link" aria-label="Direct link to Cluster Farmer Architecture" title="Direct link to Cluster Farmer Architecture">​</a></h2>
<p>Because of how modular a Cluster is, depending on your setup you may want to deploy only certain parts of the Cluster on certain PCs. Let us start with a minimal Cluster:</p>
<p><img decoding="async" loading="lazy" alt="Minimal Cluster" src="/assets/images/minimal_cluster-a735ee6120ecaa6eec4dd655dbff5fc3.png" width="963" height="549" class="img_ev3q"></p>
<ol>
<li>The <strong>Node</strong> (which stores blockchain data on an SSD) connects to the <strong>Controller</strong>. This is NOT part of the cluster, but shown to highlight the relationship</li>
<li>The <strong>Controller</strong> is connected to the <strong>Node</strong> and <strong>NATs</strong>, this acts as sort of the brains of the Cluster</li>
<li>The <strong>Cache</strong> is connected to <strong>NATs</strong> and stores blockchain data for plotting on an SSD.</li>
<li>The <strong>Plotter</strong> is connected to <strong>NATs</strong> and uses GPU or CPU resources to plot to any Farmers connected to the network.</li>
<li>The <strong>Farmer</strong> is connected to <strong>NATs</strong> and SSDs which will be used to store blockchain data for farming.</li>
</ol>
<p>Because of how modular a Cluster is, you can add more Plotters if you want to plot faster, more Farmers if you want to farm more space, and more Cache and/or Controllers to increase efficiency. For instance, many users put a Cache on every PC with a Plotter to reduce network traffic.</p>
<p>For redundancy, you can run multiple Controllers and Cache pairs. Additional redundancy can be added for NATs by running a NATs cluster (different than an Autonomys cluster). These more complex topics will be covered in the <a href="https://hakehardware.github.io/docs/guides/autonomys/advanced-clusters" target="_blank" rel="noopener noreferrer">Advanced Clusters Guide</a>.</p>
<p>Before we continue, let us take a look at a slightly more complex but very common Cluster set up.</p>
<p><img decoding="async" loading="lazy" alt="Common Cluster" src="/assets/images/common_cluster-7c78a5f0c68aea2f5141205dd395ab82.png" width="1298" height="625" class="img_ev3q"></p>
<p>In this setup, we see two addtional Plotters and two additional Farmers. The benefit of Clusters is that you can add many Farmers and Plotters without a lot of additional overhead. Simply connect a new Farmer or Plotter to your Cluster and the Controller with detect it and begin Plotting and Farming.</p>
<p>One thing to make clear is that each PC only needs to run a single instance of a Cluster component. There is no real benefit to running multiple Plotters or Farmers on the same PC. One caveat at the time of writing this guide, is that some people have reported getting more performance out of their GPU plotting by running multiple Plotters. But this will likely not be needed for long and generally should be avoided.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="preparing-for-a-cluster">Preparing for a Cluster<a href="#preparing-for-a-cluster" class="hash-link" aria-label="Direct link to Preparing for a Cluster" title="Direct link to Preparing for a Cluster">​</a></h2>
<p>Certain components of a Cluster require preperation. We will cover what is necessary for each component below. I prefer to create these directories in my home directory, but you can place them wherever is most convienent. Just make sure your containers reflect the actual path.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="nats">NATs<a href="#nats" class="hash-link" aria-label="Direct link to NATs" title="Direct link to NATs">​</a></h3>
<p>Any PC that will run NATs needs to have a config file specified in the container. I typically put this at the path <code>~/autonomys/nats</code>. We can do this with a single command which does the following:</p>
<ol>
<li>Create a folder in the home directory called &quot;autonomys&quot; and create a sub-directory called &quot;nats&quot; inside it.</li>
<li>Create a file called &quot;nats.config&quot;</li>
<li>Add the text <code>max_payload = 2MB</code> inside the config.</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p ~/autonomys/nats &amp;&amp; echo &quot;max_payload = 2MB&quot; &gt; ~/autonomys/nats/nats.config</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="controller">Controller<a href="#controller" class="hash-link" aria-label="Direct link to Controller" title="Direct link to Controller">​</a></h3>
<p>Any PC that will run a Controller needs to have a folder that it can use to store files. I typically put this at the path <code>~/autonomys/controller</code> and we can create this by running</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p ~/autonomys/controller</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cache">Cache<a href="#cache" class="hash-link" aria-label="Direct link to Cache" title="Direct link to Cache">​</a></h3>
<p>Any PC that will run a Cache needs to have a folder that it can store the cache files. I typically put this at the path <code>~/autonomys/cache</code> and we can create this by running</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p ~/autonomys/cache</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="set-appropriate-permissions-required-for-all-components">Set Appropriate Permissions (required for all components)<a href="#set-appropriate-permissions-required-for-all-components" class="hash-link" aria-label="Direct link to Set Appropriate Permissions (required for all components)" title="Direct link to Set Appropriate Permissions (required for all components)">​</a></h2>
<p>For everything to work correctly, we need to set the appropriate permissions. This applies to ALL the folders and files created above. In my examples, everything is inside the <code>~/autonomys</code> folder, so I can simply run</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo chown -R nobody:nogroup ~/autonomys/*</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If you changed the location of the folders or files, modify the command as needed. To check the permissions are set correctly you can run</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ls -l /your/path</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Using my example, you should get something like this</p>
<p><img decoding="async" loading="lazy" alt="permissions" src="/assets/images/permissions-0f7cc20fec2e181e0f7c0ed4e25e3c1c.png" width="472" height="92" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="cluster-stack-files">Cluster Stack Files<a href="#cluster-stack-files" class="hash-link" aria-label="Direct link to Cluster Stack Files" title="Direct link to Cluster Stack Files">​</a></h2>
<p>Each component of a Cluster gets deployed as a Docker container. In Portainer, we can add the code for all containers into a single YAML file and deploy everything at once. You will need to use the locations of the folders and files noted above, along with the location of the SSDs your Farmer will plot to in order to successfully deploy the containers.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="all-in-one">All-In-One<a href="#all-in-one" class="hash-link" aria-label="Direct link to All-In-One" title="Direct link to All-In-One">​</a></h3>
<p>The first setup we will cover is running a Node + Cluster on one PC. There are multiple benefits to running a Cluster even if you will have everything on one PC. First, you can specify the size of your Cache to be the optimal size for the fastest possible plotting. Second, you will already have a Cluster set up if you ever want to expand. Third, it really is no more difficult than not running a Cluster.</p>
<p>Here is the basic architecture for an all-in-one setup</p>
<p><img decoding="async" loading="lazy" alt="All in One" src="/assets/images/all-in-one-845d15ca1bcd608dc8cfc4b3fe3daff1.png" width="1312" height="606" class="img_ev3q"></p>
<p>On the left side are the resource we use. You will need an SSD (two shown, but can be 1 SSD with sufficient space) and either a GPU (recommended) or CPU for plotting. The Cluster Farmer can handle lots of SSDs, but requires at least one. On the right side you can see all of the Cluster components needed. In this scenario, the Node has its own stack file, NATs has its own stack file, and the Cluster has its own stack file. This separation is not necessarily required, but I prefer to compartmentalize these operations. On the <a href="https://github.com/hakehardware/autonomys_files" target="_blank" rel="noopener noreferrer">autonomys_files</a> repo, there is an example YAML for each. Note that you should run the cluster-cpu.yaml if you do not have a supported GPU and the cluster-gpu.yaml if you have a supported GPU.</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>If you are using an ARM platform like the COMET, you must uncomment the <code>platform: linux/amd64</code> in the yaml files</p></div></div>
<ol>
<li><a href="https://github.com/hakehardware/autonomys_files/blob/main/node.yaml" target="_blank" rel="noopener noreferrer">node.yaml</a></li>
<li><a href="https://github.com/hakehardware/autonomys_files/blob/main/nats.yaml" target="_blank" rel="noopener noreferrer">nats.yaml</a></li>
<li><a href="https://github.com/hakehardware/autonomys_files/blob/main/cluster-gpu.yaml" target="_blank" rel="noopener noreferrer">cluster-gpu.yaml (For GPU Plotting)</a></li>
<li><a href="https://github.com/hakehardware/autonomys_files/blob/main/cluster-cpu.yaml" target="_blank" rel="noopener noreferrer">cluster-cpu.yaml (For CPU Plotting)</a></li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="split-setup">Split-Setup<a href="#split-setup" class="hash-link" aria-label="Direct link to Split-Setup" title="Direct link to Split-Setup">​</a></h3>
<p>The main benefit of a Cluster is that you can split it up and duplicate it. This is a more complex setup where you have multiple cluster components.</p>
<p><img decoding="async" loading="lazy" alt="All in One" src="/assets/images/complex_setup-e303eafbdd09a90f0618b8cdaf9303e2.png" width="1410" height="1027" class="img_ev3q"></p>
<p>In this example, we see that there is a dedicated Node which handles only Node related things. The Node is connected to the Cluster Controller which is running on a dedicated Cluster. On the dedicated Cluster, the Controller is connected to the Node and NATs. Each of the other Cluster components just attach to NATs. Then there is a dedicated Plotter which is connected to the NATs container on the dedicated Cluster. Last, there is a dedicated Farmer which connects to the NATs container on the dedicated Cluster.</p>
<p>In this example, all Cluster components are being managed by the dedicated Cluster. If that PC goes down, the whole cluster breaks. You could add redundancy here by having the dedicated Plotter and Farmer run NATs and a Controller as well. This topic is covered in <a href="https://hakehardware.github.io/docs/guides/autonomys/advanced-clusters" target="_blank" rel="noopener noreferrer">Advanced Clusters Guide</a>.</p>
<p>As with the last set up, the files to create this type of setup are found in the <a href="https://github.com/hakehardware/autonomys_files" target="_blank" rel="noopener noreferrer">autonomys_files</a> repo.</p>
<ol>
<li>Dedicated Node would use <a href="https://github.com/hakehardware/autonomys_files/blob/main/node.yaml" target="_blank" rel="noopener noreferrer">node.yaml</a></li>
<li>Dedicated Cluster would use the <a href="https://github.com/hakehardware/autonomys_files/blob/main/nats.yaml" target="_blank" rel="noopener noreferrer">nats.yaml</a> and the <a href="https://github.com/hakehardware/autonomys_files/blob/main/cluster-gpu.yaml" target="_blank" rel="noopener noreferrer">cluster-gpu.yaml (For GPU Plotting)</a> or <a href="https://github.com/hakehardware/autonomys_files/blob/main/cluster-cpu.yaml" target="_blank" rel="noopener noreferrer">cluster-cpu.yaml (For CPU Plotting)</a></li>
<li>Dedicated Plotter would use <a href="https://github.com/hakehardware/autonomys_files/blob/main/cluster-gpu.yaml" target="_blank" rel="noopener noreferrer">cluster-gpu.yaml (For GPU Plotting)</a> or <a href="https://github.com/hakehardware/autonomys_files/blob/main/cluster-cpu.yaml" target="_blank" rel="noopener noreferrer">cluster-cpu.yaml (For CPU Plotting)</a></li>
<li>Dedicated Farmer would use <a href="https://github.com/hakehardware/autonomys_files/blob/main/farmer.yaml" target="_blank" rel="noopener noreferrer">farmer.yaml</a></li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ip-addresses-and-docker">IP Addresses and Docker<a href="#ip-addresses-and-docker" class="hash-link" aria-label="Direct link to IP Addresses and Docker" title="Direct link to IP Addresses and Docker">​</a></h2>
<p>One thing to keep in mind is that the Dedicated Plotter and Dedicated Farmer will need to use the IP address of the Dedicated Cluster to connect to NATs. And the Dedicated Cluster will need to use the IP address of the Dedicated Node to connect the Controller to the Node. The rule of thumb is if the containers are on the same PC they can use the Docker IP or container name. But if they are on another PC you must use their internal IP address.</p>
<p>Here is a demonstrated example</p>
<p><img decoding="async" loading="lazy" alt="All in One" src="/assets/images/ip_addresses-93f955c42ad9c9a3e94ece25b00949e3.png" width="1365" height="734" class="img_ev3q"></p>
<p>As you can see, the dedicated Cluster uses the Docker IP to make the internal NATs connections. But since the Controller has to reach outside the Docker network to connect to the Node, we need to specify the IP address of the PC hosting the Node, and not the Docker IP. Same with the Plotter and Farmer.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="optimizations">Optimizations<a href="#optimizations" class="hash-link" aria-label="Direct link to Optimizations" title="Direct link to Optimizations">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="farmer">Farmer<a href="#farmer" class="hash-link" aria-label="Direct link to Farmer" title="Direct link to Farmer">​</a></h3>
<p>Everytime you start your Farmer it will do a benchmark to determine the most efficient proving method. This only needs to be done once to determine if its <code>ConcurrentChunks</code> or <code>WholeSector</code>. Once you know, you can hard code the results into the stack file by modifying the path to something like</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">path=/farm</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">size=100G</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">record</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">chunks</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">mode=&lt;ConcurrentChunks or WholeSector</span><span class="token punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/hakehardware/hakehardware.github.io/edit/main/docs/guides/autonomys/docker-cluster-autonomys.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/guides/autonomys/docker-node-autonomys"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Run an Autonomys Node on Docker</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/guides/autonomys/prep-your-drives-for-autonomys"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Prep Your Drives for Autonomys</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#create-an-autonomys-network-in-docker" class="table-of-contents__link toc-highlight">Create an Autonomys Network in Docker</a></li><li><a href="#cluster-farmer-architecture" class="table-of-contents__link toc-highlight">Cluster Farmer Architecture</a></li><li><a href="#preparing-for-a-cluster" class="table-of-contents__link toc-highlight">Preparing for a Cluster</a><ul><li><a href="#nats" class="table-of-contents__link toc-highlight">NATs</a></li><li><a href="#controller" class="table-of-contents__link toc-highlight">Controller</a></li><li><a href="#cache" class="table-of-contents__link toc-highlight">Cache</a></li></ul></li><li><a href="#set-appropriate-permissions-required-for-all-components" class="table-of-contents__link toc-highlight">Set Appropriate Permissions (required for all components)</a></li><li><a href="#cluster-stack-files" class="table-of-contents__link toc-highlight">Cluster Stack Files</a><ul><li><a href="#all-in-one" class="table-of-contents__link toc-highlight">All-In-One</a></li><li><a href="#split-setup" class="table-of-contents__link toc-highlight">Split-Setup</a></li></ul></li><li><a href="#ip-addresses-and-docker" class="table-of-contents__link toc-highlight">IP Addresses and Docker</a></li><li><a href="#optimizations" class="table-of-contents__link toc-highlight">Optimizations</a><ul><li><a href="#farmer" class="table-of-contents__link toc-highlight">Farmer</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Content</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/category/linux">Guides</a></li><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/uAdsVBWYfX" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Hake Hardware, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>